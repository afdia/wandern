<!DOCTYPE html>
<html>
  <head>
    <title>Routenplaner</title>
    <link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/vue@latest/dist/vue.min.js" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-vue@latest/dist/bootstrap-vue.css" />
  </head>

  <body>
    <script src="https://cdn.jsdelivr.net/npm/vue@latest/dist/vue.min.js"></script>
    <div id="app">
      <h1>Tools</h1>
      <p>
        <a href="https://www.gpsvisualizer.com/convert_input">GPS Visualizer</a>
      </p>

      <h1>Routes</h1>
      <button @click="addCurLocation">Add Location</button>
      <div>Current Route:</div>
      <div v-for="(item, index) in prev"><button @click="deleteRoute(item,index)">delete</button><a style="margin-left: 1em;" :href="`${gmaps}${item.v}`">{{item.k}} ({{countStops(item.v)}} Stops)</a><br /></div>
      <br />
      <div v-if="currentRoute !== ''"><a :href="`${gmaps}${currentRoute}`">{{currentRouteName}} ({{countStops(currentRoute)}} Stops)</a></div>
      <label for="routename">Route Name:</label>
      <input type="text" id="routename" v-model="routeName" />
      <button :disabled="saveDisabled" @click="saveRoute">Save Route</button>
      <p style="color: red; font-size: 1.5em;" v-if="showAdded">ADDED STOP</p>
    </div>
    <script>
      const gmaps = "https://www.google.com/maps/dir";
      const currentRouteName = "Current Route"; // key fuer aktuell entstehende route
      new Vue({
        el: "#app",
        data() {
          return {
            prev: [],
            currentRoute: "",
            routeName: "",
            showAdded: false,
          };
        },
        computed: {
          saveDisabled() {
            return this.currentRoute === "" || this.routeName === "";
          },
        },
        created() {
          this.loadRoutesFromLocalStorage();
        },
        methods: {
          countStops(url) {
            return url.split(",").length - 1;
          },
          addCurLocation() {
            navigator.geolocation.getCurrentPosition((position) => {
              let oldPart = localStorage.getItem(currentRouteName) == null ? "" : localStorage.getItem(currentRouteName);
              let coordinates = position.coords.latitude + "," + position.coords.longitude;
              this.currentRoute = oldPart + "/" + coordinates;
              localStorage.setItem(currentRouteName, this.currentRoute);
              this.showAdded = true;
              setTimeout(() => (this.showAdded = false), 2000);
            });
          },
          saveRoute() {
            localStorage.setItem(this.routeName, this.currentRoute);
            this.currentRoute = "";
            localStorage.removeItem(currentRouteName);
            this.loadRoutesFromLocalStorage();
          },
          deleteRoute(item, index) {
            if (confirm("Route " + item.k + " wirklich lÃ¶schen?")) {
              this.prev.splice(index, 1);
              localStorage.removeItem(item.k);
            }
          },
          loadRoutesFromLocalStorage() {
            this.prev = [];
            Object.keys(localStorage).map((k) => {
              if (k == currentRouteName) {
                this.currentRoute = localStorage.getItem(k);
              } else {
                this.prev.push({ k: k, v: localStorage.getItem(k) });
              }
            });
          },
        },
      });
    </script>
  </body>
</html>
